{
  "version": 3,
  "sources": ["../src/index.tsx"],
  "sourcesContent": ["import { useCallback } from \"react\";\nimport type {\n\tSetState,\n\tState,\n\tStateCreator,\n\tStoreApi,\n\tSubscribe,\n\tUseStore,\n} from \"zustand\";\nimport create from \"zustand\";\nimport shallow from \"zustand/shallow\";\n\ninterface StoreMethods<TState extends State> {\n\tuseGlobalState<Key extends keyof TState>(\n\t\tselector: Key,\n\t\tcomparator?: (a: unknown, b: unknown) => boolean,\n\t): TState[Key];\n\tuseStore: UseStore<TState>;\n\tgetStates(): TState;\n\tsetStates(newStore: TState): void;\n\tupdateStates(\n\t\tpartial: Partial<TState>,\n\t\tupdater?: (partial: Partial<TState>) => void,\n\t): void;\n\tcreatePropUpdater<Prop extends keyof TState>(\n\t\tpropName: Prop,\n\t): (\n\t\tpartial: Partial<TState[Prop]>,\n\t\tupdater?: (partial: Partial<TState>) => void,\n\t) => void;\n\tsubscribe: Subscribe<TState>;\n}\n\nexport const createStore = function createStore<TState extends State>(\n\tinitState: TState,\n\tinitialStateCreator:\n\t\t| StateCreator<TState, SetState<TState>>\n\t\t| StoreApi<TState> = () => initState,\n): StoreMethods<TState> {\n\ttype StoreKey = keyof TState;\n\n\t// create the store\n\tconst useStore = create(initialStateCreator);\n\n\tconst { getState: getStates, setState: setStates, subscribe } = useStore;\n\n\t// global state merger. unlike redux, I am not enforcing reducer layer\n\tconst plainObjectPrototype = Object.getPrototypeOf({});\n\tfunction isPlainObject(obj: unknown): boolean {\n\t\treturn Boolean(\n\t\t\tobj &&\n\t\t\t\ttypeof obj === \"object\" &&\n\t\t\t\tObject.getPrototypeOf(obj) === plainObjectPrototype,\n\t\t);\n\t}\n\n\tfunction shallowUpdater(partial: Partial<TState>) {\n\t\tconst store = getStates();\n\t\tconst mergedPartial = {};\n\t\tconst propNames = Object.keys(partial);\n\t\twhile (propNames.length) {\n\t\t\tconst propName: string = propNames.shift() as string;\n\t\t\tconst oldValue = store[propName];\n\t\t\tconst newValue = partial[propName];\n\t\t\tif (isPlainObject(oldValue) && isPlainObject(newValue)) {\n\t\t\t\tconst oldObj = oldValue as Record<string, unknown>;\n\t\t\t\tconst newObj = newValue as Record<string, unknown>;\n\t\t\t\tmergedPartial[propName] = {\n\t\t\t\t\t...oldObj,\n\t\t\t\t\t...newObj,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmergedPartial[propName] = newValue;\n\t\t\t}\n\t\t}\n\t\tsetStates({\n\t\t\t...store,\n\t\t\t...mergedPartial,\n\t\t});\n\t}\n\n\t// updateStates merges properties upto two levels of the data store\n\tfunction updateStates(\n\t\tpartial: Partial<TState>,\n\t\tupdater: (partial: Partial<TState>) => void = shallowUpdater,\n\t) {\n\t\treturn updater(partial);\n\t}\n\n\t// curry function to partially update a sub property of global store.\n\t// e.g const updateCart = createPropUpdater('cart');\n\t// updateCart({ items: [], quantity: 0 });\n\t// this is equivalent to\n\t// updateStates({ cart: { items: [], quantity: 0 } })\n\tfunction createPropUpdater<Prop extends StoreKey>(propName: Prop) {\n\t\treturn function propUpdater(\n\t\t\tpartial: Partial<TState[Prop]>,\n\t\t\tupdater: (partial: Partial<TState>) => void = shallowUpdater,\n\t\t) {\n\t\t\treturn updater({ [propName]: partial } as Partial<TState>);\n\t\t};\n\t}\n\n\tfunction useGlobalState<Key extends StoreKey>(\n\t\tpropName: Key,\n\t\tcomparator = shallow,\n\t): TState[Key] {\n\t\tconst selectorFunction = useCallback(\n\t\t\t(store: TState) => store[propName],\n\t\t\t[propName],\n\t\t);\n\t\tconst results = useStore(selectorFunction, comparator);\n\t\treturn results;\n\t}\n\n\treturn {\n\t\tuseGlobalState,\n\t\tgetStates,\n\t\tsetStates,\n\t\tupdateStates,\n\t\tcreatePropUpdater,\n\t\t// zustand aliases\n\t\tuseStore,\n\t\tsubscribe,\n\t};\n};\n\nconst defaultStore = createStore({});\n\nexport const {\n\tuseGlobalState,\n\tgetStates,\n\tsetStates,\n\tupdateStates,\n\tcreatePropUpdater,\n\tuseStore,\n\tsubscribe,\n} = defaultStore;\n\n// -------------- app code testing ------------------\n/*\ntype MyStoreType = {\n\tgreeting: string;\n\tcart: {\n\t\ttotalQty: number;\n\t\titems: {\n\t\t\tqty: number;\n\t\t\tsku: string;\n\t\t}[];\n\t};\n\ttest: {\n\t\ttest2: string;\n\t};\n}\nconst { updateStates: updater } = createStore<MyStoreType>({\n\tgreeting: 'hi',\n\tcart: { totalQty: 0, items: [] },\n\ttest: { test2: 'hi' },\n});\nupdater({ greeting: 'hi' }); // no error\nupdater({ cart: { greeting: 'hi' } }); // error\nupdater({ cart: { cart: {} } }); // error\nupdater({ cart: { test: {} } }); // error\nupdater({ cart: { test2: 'h1' } }); // error\nupdater({ cart: { totalQty: 0, items: [] } }); // no error\n*/\n"],
  "mappings": "AAAA,OAAS,eAAAA,MAAmB,QAS5B,OAAOC,MAAY,UACnB,OAAOC,MAAa,kBAuBb,IAAMC,EAAc,SAC1BC,EACAC,EAEsB,IAAMD,EACL,CAIvB,IAAME,EAAWL,EAAOI,CAAmB,EAErC,CAAE,SAAUE,EAAW,SAAUC,EAAW,UAAAC,CAAU,EAAIH,EAG1DI,EAAuB,OAAO,eAAe,CAAC,CAAC,EACrD,SAASC,EAAcC,EAAuB,CAC7C,MAAO,GACNA,GACC,OAAOA,GAAQ,UACf,OAAO,eAAeA,CAAG,IAAMF,EAElC,CAEA,SAASG,EAAeC,EAA0B,CACjD,IAAMC,EAAQR,EAAU,EAClBS,EAAgB,CAAC,EACjBC,EAAY,OAAO,KAAKH,CAAO,EACrC,KAAOG,EAAU,QAAQ,CACxB,IAAMC,EAAmBD,EAAU,MAAM,EACnCE,EAAWJ,EAAMG,CAAQ,EACzBE,EAAWN,EAAQI,CAAQ,EACjC,GAAIP,EAAcQ,CAAQ,GAAKR,EAAcS,CAAQ,EAAG,CACvD,IAAMC,EAASF,EACTG,EAASF,EACfJ,EAAcE,CAAQ,EAAI,CACzB,GAAGG,EACH,GAAGC,CACJ,CACD,MACCN,EAAcE,CAAQ,EAAIE,CAE5B,CACAZ,EAAU,CACT,GAAGO,EACH,GAAGC,CACJ,CAAC,CACF,CAGA,SAASO,EACRT,EACAU,EAA8CX,EAC7C,CACD,OAAOW,EAAQV,CAAO,CACvB,CAOA,SAASW,EAAyCP,EAAgB,CACjE,OAAO,SACNJ,EACAU,EAA8CX,EAC7C,CACD,OAAOW,EAAQ,CAAE,CAACN,CAAQ,EAAGJ,CAAQ,CAAoB,CAC1D,CACD,CAEA,SAASY,EACRR,EACAS,EAAazB,EACC,CACd,IAAM0B,EAAmB5B,EACvBe,GAAkBA,EAAMG,CAAQ,EACjC,CAACA,CAAQ,CACV,EAEA,OADgBZ,EAASsB,EAAkBD,CAAU,CAEtD,CAEA,MAAO,CACN,eAAAD,EACA,UAAAnB,EACA,UAAAC,EACA,aAAAe,EACA,kBAAAE,EAEA,SAAAnB,EACA,UAAAG,CACD,CACD,EAEMoB,EAAe1B,EAAY,CAAC,CAAC,EAEtB,CACZ,eAAAuB,EACA,UAAAnB,EACA,UAAAC,EACA,aAAAe,EACA,kBAAAE,EACA,SAAAnB,EACA,UAAAG,CACD,EAAIoB",
  "names": ["useCallback", "create", "shallow", "createStore", "initState", "initialStateCreator", "useStore", "getStates", "setStates", "subscribe", "plainObjectPrototype", "isPlainObject", "obj", "shallowUpdater", "partial", "store", "mergedPartial", "propNames", "propName", "oldValue", "newValue", "oldObj", "newObj", "updateStates", "updater", "createPropUpdater", "useGlobalState", "comparator", "selectorFunction", "defaultStore"]
}
